# 连接问题解决指南

## 🔧 问题描述

页面刷新后，扩展功能无法正常工作，出现"连接失败"或"页面连接失败"的提示。

## 🎯 解决方案

### 自动修复（推荐）

扩展现在具备自动连接修复功能：

1. **自动检测**：扩展会自动检测与页面的连接状态
2. **自动重试**：连接失败时会自动重试多次
3. **自动注入**：重试失败时会自动重新注入Content Script
4. **状态反馈**：提供实时的连接状态反馈

### 手动解决方法

如果自动修复失败，可以尝试以下方法：

#### 方法1：刷新页面
- 按 `F5` 或 `Ctrl+R` 刷新当前页面
- 等待页面完全加载后再使用扩展功能

#### 方法2：重新加载扩展
1. 打开 `chrome://extensions/`
2. 找到"元气助手"扩展
3. 点击刷新按钮重新加载扩展
4. 返回页面测试功能

#### 方法3：检查扩展权限
1. 确保扩展已启用
2. 检查是否有必要的权限
3. 确认当前页面不是特殊页面（如chrome://）

## 🧪 测试连接状态

使用专门的测试页面验证连接修复功能：

1. 打开 `test-connection-repair.html`
2. 点击"检查连接状态"按钮
3. 如果显示连接异常，点击"测试自动修复"
4. 观察修复过程和结果

## 📊 连接状态说明

### ✅ 连接正常
- Content Script已注入
- 扩展功能可正常使用
- 状态显示为"已连接"

### ❌ 连接异常
- Content Script未注入或已断开
- 扩展功能无法使用
- 状态显示为"连接失败"

### ⚠️ 特殊页面
- 浏览器内置页面（chrome://、about:等）
- 扩展页面
- 本地文件页面
- 这些页面不支持扩展功能

## 🔍 故障排查

### 检查浏览器控制台

1. 按 `F12` 打开开发者工具
2. 切换到"Console"标签
3. 查找以下日志：
   - `[网页工具-简化版] Content Script 开始加载`
   - `[网页工具-简化版] 扩展功能初始化完成`
   - `[侧边栏] 连接成功，收到响应`

### 常见错误信息

| 错误信息 | 可能原因 | 解决方法 |
|---------|---------|---------|
| `Could not establish connection` | Content Script未注入 | 刷新页面或重新加载扩展 |
| `连接超时` | 页面响应慢 | 等待页面完全加载 |
| `特殊页面不支持注入` | 当前页面不支持扩展 | 切换到普通网页 |
| `缺少scripting权限` | 扩展权限不足 | 重新安装扩展 |

## 🚀 性能优化

### 减少连接问题的建议

1. **等待页面加载**：页面完全加载后再使用扩展功能
2. **避免频繁刷新**：给扩展足够的初始化时间
3. **检查网络状况**：确保网络连接稳定
4. **关闭不必要的扩展**：避免扩展冲突

### 最佳实践

1. **使用自动配置**：启用自动配置应用功能
2. **定期更新扩展**：保持扩展为最新版本
3. **反馈问题**：遇到问题及时反馈给开发者

## 📞 获取帮助

如果问题仍然存在，请：

1. 使用测试页面收集详细信息
2. 记录浏览器控制台的错误信息
3. 提供页面URL和操作步骤
4. 联系开发者获取技术支持

---

**注意**：连接修复功能会在后台自动运行，通常无需手动干预。如果经常遇到连接问题，建议检查浏览器设置和网络环境。 